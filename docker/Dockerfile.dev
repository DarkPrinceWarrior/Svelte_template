# ===========================================
# Dockerfile для разработки SvelteKit приложения
# ===========================================
# Этот Dockerfile предназначен для локальной разработки
# с поддержкой hot-reload и быстрой пересборки

# ===========================================
# Этап 1: Установка зависимостей
# ===========================================
FROM node:20-alpine AS dependencies

# Устанавливаем рабочую директорию
WORKDIR /app

# Копируем файлы зависимостей для кэширования слоев Docker
COPY package.json package-lock.json* ./

# Устанавливаем все зависимости (включая dev-зависимости для разработки)
# Используем npm ci если есть package-lock.json, иначе npm install
RUN if [ -f package-lock.json ]; then npm ci --include=dev; else npm install; fi

# ===========================================
# Этап 2: Сборка приложения для разработки
# ===========================================
FROM node:20-alpine AS development

# Устанавливаем рабочую директорию
WORKDIR /app

# Копируем установленные зависимости из предыдущего этапа
COPY --from=dependencies /app/node_modules ./node_modules

# Копируем исходный код приложения
COPY . .

# Открываем порт для разработки
EXPOSE 3000

# Запускаем сервер разработки с hot-reload
CMD ["npm", "run", "dev", "--", "--host", "0.0.0.0"]